function fetchDays(e,t){var n=cal_api+"cal/";typeof e!="undefined"&&(n+=e+"/"+t),$.getJSON(n).done(function(e){renderCal(e)})}function login(){$("#change_user").click(function(){$(".shape").shape("flip over")});var e=cal_api+"login";$("#login").api({url:e,method:"post",beforeSend:function(e){console.log(e);var t=$(".active.side input.username").val(),n=$(".active.side input.password").val();return n?(e.data={username:t,password:n},e):(alert("please input password!"),!1)},onSuccess:function(e){e.status_code==0?location.reload():alert("Login failed!")}})}function renderCal(e){renderCal.year=parseInt(e.year),renderCal.month=parseInt(e.month),console.log(e);if(typeof renderCal.compiled=="undefined"){var t={"#calendar-title":"cal-title","#calendar-title@data-year":"year","#calendar-title@data-month":"month"};for(var n=0;n<6;++n){var r={};r["day<-week"+n]={".":"day.day","@class":function(e){switch(e.item.style){case"full-love markday":return e.item.style+" animated infinite pulse";default:return e.item.style}},"@style":function(e){switch(e.item.style){case"today":var t=feather.icons.heart.toSvg();return"background-image: url('data:image/svg+xml;utf8,"+t+"')";case"half-love markday":var t=feather.icons.heart.toSvg({color:e.item.mark_color});return"background-image: url('data:image/svg+xml;utf8,"+t+"')";case"full-love markday":var t=feather.icons.heart.toSvg({color:"red",fill:"red"});return"background-image: url('data:image/svg+xml;utf8,"+t+"')"}},"@data-date":function(e){return e.item.year+"-"+e.item.month+"-"+e.item.day}},t["#week"+n+" td"]=r}renderCal.compiled=$p("#cal").compile(t)}$p("#cal").render(e,renderCal.compiled),$("#prev-month").click(function(){renderCal.month-1>=1?fetchDays(renderCal.year,renderCal.month-1):fetchDays(renderCal.year-1,12)}),$("#next-month").click(function(){renderCal.month+1<=12?fetchDays(renderCal.year,renderCal.month+1):fetchDays(renderCal.year+1,1)}),$("#menu").click(function(){$(".ui.sidebar").sidebar("toggle")}),$(".markday").click(function(){var e=$(this).attr("data-date");e=e.split("-"),fetchNotes(e[0],e[1],e[2])})}function fetchNotes(e,t,n){var r=cal_api+"notes";typeof e!="undefined"&&(r+="/"+e+"/"+t+"/"+n);if(typeof fetchNotes.compiled=="undefined"){var i={".event":{"note<-notes":{".avatar@src":"note.avatar",".name":"note.author",".date":"note.timestamp",".meta@style":function(e){return e.item.editable?"":"display:none"},".delete-note@data-note-id":"note.id",".edit-note@data-note-id":"note.id",".note-content@data-note-id":"note.id",".note-content@data-content":"note.content",".note-content":function(e){return markdown.toHTML(e.item.content)}}}};fetchNotes.compiled=$p(".detail.modal .feed").compile(i)}$.getJSON(r).done(function(r){$p(".detail.modal .feed").render(r,fetchNotes.compiled),$(".note-content a").attr("target","_blank"),$(".detail.modal .header").text(r.year+"-"+r.month+"-"+r.day),$(".detail.modal").modal({onApprove:function(){return addNote(e,t,n),!1}}).modal("show"),localStorage.getItem("typeit-mode")||localStorage.setItem("typeit-mode","off"),localStorage.getItem("typeit-mode")==="on"?($("#typeit").checkbox("check"),typing(!0)):$(".note-content").readmore({speed:500}),$("#typeit").checkbox({onChecked:function(){localStorage.setItem("typeit-mode","on"),typing(!0)},onUnchecked:function(){localStorage.setItem("typeit-mode","off"),typing(!1)}}),$(".delete-note").click(function(){$(".dialog.modal .header").text("Delete Note"),$(".dialog.modal .content").text("Do you want to delete it?"),showDialog();var e=$(this),t=cal_api+"note/"+e.attr("data-note-id")+"/delete";$(".dialog.modal .positive.button").api({url:t,method:"post",onSuccess:function(t){t.status_code==0&&(e.parents(".event").remove(),fetchDays(renderCal.year,renderCal.month),$(".dialog.modal").modal("hide"))}})}),$(".edit-note").click(function(){var e=$(this),t=cal_api+"note/"+e.attr("data-note-id"),n=cal_api+"note/"+e.attr("data-note-id")+"/update";$.getJSON(t).done(function(t){t.status_code==0&&($(".editor.modal textarea").val(t.note.content),$(".editor.modal .approve.button").text("Update"),showEditor(),$(".editor.modal .positive.button").api({url:n,method:"post",beforeSend:function(e){var t=$(".editor.modal textarea").val();return t?(e.data={content:t},e):(alert("please input content!"),!1)},onSuccess:function(t){var n=$(".editor.modal textarea").val();t.status_code==0&&($(".detail.modal .feed .note-content[data-note-id="+e.attr("data-note-id")+"]").html(markdown.toHTML(n)),$(".note-content a").attr("target","_blank"),$(".editor.modal").modal("hide"))}}))})})})}function addNote(e,t,n){$(".editor.modal textarea").val(localStorage.getItem("new-note")),$(".editor.modal .approve.button").text("Biu");var r=setInterval(function(){localStorage.setItem("new-note",$(".editor.modal textarea").val())},2e3),i=function(){clearInterval(r)};showEditor(i,i);var s=cal_api+"note/new";typeof e!="undefined"&&(s=cal_api+"note/"+e+"/"+t+"/"+n+"/new"),$(".editor.modal .positive.button").api({url:s,method:"post",beforeSend:function(e){var t=$(".editor.modal textarea").val();return t?(e.data={content:t},e):(alert("please input content!"),!1)},onSuccess:function(r){r.status_code==0&&(i(),fetchDays(renderCal.year,renderCal.month),fetchNotes(e,t,n),localStorage.removeItem("new-note"),$(".editor.modal").modal("hide"))}})}function sidebar(){$("#write-note").click(function(){addNote()}),$("#logout").click(function(){$(".dialog.modal .header").text("Logout"),$(".dialog.modal .content").text("Do you want to sign out?"),showDialog();var e=cal_api+"logout";$(".dialog.modal .positive.button").api({url:e,onSuccess:function(e){e.status_code==0&&location.reload()}})})}function showDialog(){$(".dialog.modal").modal({allowMultiple:!0,blurring:!0,closable:!0,onApprove:function(){return!1}}).modal("show")}function showEditor(e,t){$(".editor.modal").modal({allowMultiple:!0,onApprove:function(){return!1},onDeny:e,onHidden:t}).modal("show")}function typing(e){e?($(".note-content").readmore("destroy"),$(".note-content").each(function(e,t){var n=$(t).attr("data-content").replace(/\n\n/g,"\n\n\n\n").split("\n\n");$(t).html(""),new TypeIt(t,{strings:n,speed:180})})):($(".note-content").each(function(e,t){$(t).html(markdown.toHTML($(t).attr("data-content")))}),$(".note-content").readmore({speed:500}))}cal_api="/api/";